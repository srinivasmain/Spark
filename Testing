# Analysis Document:

## Objective:
The objective of the provided PySpark code is to process Hive tech metadata by comparing columns between a Hive DataFrame (`dcm_hive_inner_df`) and an Oracle DataFrame (`col_details_df`). If the column names in the Oracle DataFrame do not match with the Hive DataFrame, the unmatched columns in the Oracle DataFrame are soft deleted.

## Code Overview:

1. **Extracting Relevant Columns:**
   - Columns such as "tableName," "databaseName," and "cluster_info" are extracted from the `table_details_df` to create `hive_tbl_dtls_df`.
   - Columns relevant to AST tables hierarchy are extracted from `ast_relation_df` to create `ast_tables_hierarchy_df`.

2. **Joining DataFrames:**
   - `dcm_hive_inner_df` is created by performing an inner join between `ast_relation_df` and `hive_tbl_dtls_df`. This join is based on matching cluster, database, and table names.

3. **Comparing Columns:**
   - `col_joined_df` is created by performing a left join between `dcm_hive_inner_df` and `col_details_df`. The join is based on matching cluster, database, table, and column names.
   - Unmatched columns in the Oracle DataFrame are identified by comparing column names.

4. **Soft Deletion of Unmatched Columns:**
   - A new DataFrame, `soft_deleted_df`, is created to store unmatched columns from the Oracle DataFrame. These columns are marked with an additional "is_deleted" column set to 1.

5. **Filtering and Displaying Results:**
   - The result DataFrame, `res_df`, is created by filtering rows where the "columnName" in `col_joined_df` is null (indicating unmatched columns) and dropping duplicate rows.
   - Both `res_df` and `soft_deleted_df` are displayed to provide insights into the results.

6. **Considerations:**
   - The code assumes that the appropriate columns exist in the provided DataFrames. Ensure that the actual column names match the ones used in the code.
   - Adjust the soft deletion strategy based on specific requirements, such as marking columns or archiving them instead of deletion.

7. **Output and Further Steps:**
   - The code outputs the result DataFrame (`res_df`) containing rows with unmatched columns and a DataFrame (`soft_deleted_df`) marking the soft-deleted columns.
   - Further steps may involve analyzing the soft-deleted columns or incorporating additional business logic based on the results.

8. **Conclusion:**
   - The code aims to efficiently handle unmatched columns between Oracle and Hive DataFrames, providing a basis for further data quality and integration processes.

